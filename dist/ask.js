var ips, networkInterfaces, readline;

networkInterfaces = require('os').networkInterfaces;

ips = require('./ips');

readline = require('readline').createInterface({
  input: process.stdin,
  output: process.stdout
});

module.exports = function(ip) {
  var addr, check, interval, p;
  interval = null;
  addr = [];
  check = function() {
    addr = ips();
    return addr.find(function(arg) {
      var address;
      address = arg.address;
      return address === ip;
    });
  };
  p = new Promise(function(resolve, reject) {
    var ask;
    ask = function() {
      var add;
      add = check();
      if (add) {
        return resolve(add);
      }
      console.log("Could not find interface with ip: " + ip);
      console.table(addr);
      return readline.question("Select network interface: ", function(idx) {
        if (addr[idx] == null) {
          console.log('Unknown index: ' + idx);
          return ask();
        }
        if (addr[idx].address !== ip) {
          return ask();
        }
        return resolve(addr[idx]);
      });
    };
    interval = setInterval(function() {
      var add;
      add = check();
      if (add) {
        return resolve(add);
      }
    }, 2000);
    return ask();
  });
  p.then(function(add) {
    console.log("using interface", add);
    clearInterval(interval);
    return readline.close();
  });
  return p;
};

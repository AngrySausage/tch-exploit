var ips, networkInterfaces, readline;

networkInterfaces = require('os').networkInterfaces;

ips = require('./ips');

readline = require('readline').createInterface({
  input: process.stdin,
  output: process.stdout
});

module.exports = function(ip) {
  var p;
  p = new Promise(function(resolve, reject) {
    var ask;
    ask = function() {
      var addr, exists;
      addr = ips();
      exists = addr.some(function(arg) {
        var address;
        address = arg.address;
        return address === ip;
      });
      if (exists) {
        return resolve();
      }
      console.log("Could not find interface with ip: " + ip);
      console.table(addr);
      return readline.question("Select network interface: ", function(idx) {
        if (addr[idx] == null) {
          console.log('Unknown index: ' + idx);
          return ask();
        }
        if (addr[idx].address !== ip) {
          return ask();
        }
        return resolve(addr[idx]);
      });
    };
    return ask();
  });
  p.then(function() {
    return readline.close();
  });
  return p;
};

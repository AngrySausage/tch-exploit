var args, createServer;

createServer = require('net').createServer;

args = require('./args');

module.exports = function() {
  return new Promise(function(resolve, reject) {
    var server;
    if (args.port) {
      return resolve(args.port);
    }
    server = createServer();
    server.unref();
    server.on('error', reject);
    return server.listen(0, function() {
      var port;
      port = server.address().port;
      return server.close(function() {
        return resolve(port);
      });
    });
  });
};

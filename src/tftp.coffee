fs = require 'fs'
tftp = require 'tftp'

module.exports = (host, firmware, callback) ->
  fs.stat firmware, (err, stats) ->
    if err
      return callback err

    if stats.isDirectory()
      return callback new Error 'You specify a file, not a directory.'

    client = tftp.createClient { host, timeout: 10000, retries: 10 }

    console.log '### TFTP PUT ' + firmware + ' to ' + host

    client.put firmware, callback

{ networkInterfaces } = require 'os'

ips = require './ips'

readline = require 'readline'
  .createInterface
    input: process.stdin
    output: process.stdout

module.exports = (ip) ->
  #cIp = 'en0'

  p = new Promise (resolve, reject) ->

    ask = ->
      addr = ips()

      exists = addr.some ({ address }) -> address is ip

      if exists
        return resolve()

      console.log "Could not find interface with ip: #{ ip }"
      console.table addr

      readline.question "Select network interface: ", (idx) ->
        if not addr[idx]?
          console.log 'Unknown index: ' + idx
          return ask()

        if addr[idx].address isnt ip
          return ask()

        resolve addr[idx]

    ask()

  p.then -> readline.close()

  p

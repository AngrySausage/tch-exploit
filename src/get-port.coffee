{ createServer } = require 'net'

args = require './args'

module.exports = ->

  new Promise (resolve, reject) ->
    if args.port
      return resolve args.port
      
    server = createServer()
    server.unref()

    server.on 'error', reject

    server.listen 0, ->
      port = server.address().port

      server.close ->
        resolve port

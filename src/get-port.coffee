{ createServer } = require 'net'

args = require './args'

module.exports = ->

  new Promise (resolve, reject) ->
    server = createServer()
    server.unref()

    server.on 'error', reject

    server.listen 0, ->
      port = server.address().port

      server.close ->
        resolve port
